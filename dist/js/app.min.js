"use strict";$(function(){function e(e){1>e&&(e=1),e=Math.floor(e),v+=e,h.addClass("bump"),g.html(v).addClass("bump").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){g.removeClass("bump"),h.removeClass("bump")});var s=$('<div class="ding">+'+e+"</div>");s.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).remove()}),h.append(s)}function s(){var e=f;for(var s in k){var n=k[s];if(v>=n.score)f=n;else if(v<n.score)break}f.speed!==e.speed&&$(".level-message").text(f.message).addClass("show").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("show")})}function n(n){if("paused"!==b&&a(n),"end"!==b&&"paused"!==b&&"restart"!==b){var o=m[Math.floor(Math.random()*f.keys)],i=C.find(".idle").first();i.length<=0?(i=$('<div class="key '+o+'"></div>'),i.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){if("end"!==b&&"restart"!==b&&!$(this).hasClass("idle")){$(this).hasClass(y)?(E+=200,E>A&&(E=A),e(f.points)):(E-=1e3,h.addClass("bad").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){h.removeClass("bad")})),s();var n=100*E/A,t=$(".percent");t.css("width",n+"%"),20>n?t.addClass("low"):60>n?t.addClass("medium").removeClass("low"):t.removeClass("low medium"),0>=E&&"running"===b&&d(),$(this).removeClass(p+" hide").addClass("idle")}}),C.append(i)):i.removeClass("idle").addClass(o),t(f.speed)}}function t(e){var s=new Date,t={delay:e,started:s.getTime()};t.interval=setTimeout(n,e,t),T.push(t)}function a(e){var s=T.indexOf(e);s>-1&&T.splice(s,1)}function o(){var e=new Date;for(var s in T){var n=T[s];n.delay-=e.getTime()-n.started,n.started=null,clearInterval(n.interval)}}function i(){var e=new Date;for(var s in T){var t=T[s];t.started=e.getTime(),t.interval=setTimeout(n,t.delay,t)}}function d(){b="end",$(".key").addClass("hide"),$(".key-selector-container").addClass("hide").removeClass("show"),$(".results").addClass("show").removeClass("hide"),$(".points-container").addClass("hide").removeClass("show"),$(".pause-btn").text("Restart"),v>I&&(I=v,sessionStorage.setItem("bestScore",I),$(".best-points .value").text(I),$(".best").fadeIn()),ga("send",{hitType:"event",eventCategory:"game",eventAction:"score",eventValue:v})}function r(){b="restart",v=0,A=5e3,E=A,f=k[0],w=1,""!==y&&h.removeClass("s-"+y),y="",C.find(".key").removeClass(p+" hide").addClass("idle"),$(".key-selector-container").addClass("show").removeClass("hide"),$(".results").addClass("hide").removeClass("show"),$(".points-container").addClass("show").removeClass("hide"),setTimeout(function(){for(var e in T){var s=T[e];clearInterval(s.interval)}T=[],g.html(v),$(".percent").css("width","100%").removeClass("low medium"),setTimeout(function(){b="running",$(".key").addClass("remove"),$(".pause-btn").text("Pause"),t(1)},950)},1e3)}function l(){b="running",$(".points-container").addClass("show"),$(".helper-container").addClass("hide"),setTimeout(function(){$(".key-selector").addClass("show fade").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("fade")})},500),t(1e3),$(".percent").css("width","100%")}var m=["ㅁ","ㄴ","ㅇ","ㄹ","ㅎ","ㅗ","ㅓ","ㅏ","ㅣ"],c={"ㅁ":65,"ㄴ":83,"ㅇ":68,"ㄹ":70,"ㅎ":71,"ㅗ":72,"ㅓ":74,"ㅏ":75,"ㅣ":76},u={65:"ㅁ",83:"ㄴ",68:"ㅇ",70:"ㄹ",71:"ㅎ",72:"ㅗ",74:"ㅓ",75:"ㅏ",76:"ㅣ"},p=m.join(" "),v=0,g=$(".points"),y="key-",C=$(".keys-container"),h=$(".key-selector"),k=[{score:0,speed:800,message:"",points:1,keys:1},{score:3,speed:750,message:"You've got it!",points:2,keys:2},{score:20,speed:670,message:"Keep going!",points:5,keys:3},{score:70,speed:620,message:"You're doing great!",points:7,keys:3},{score:150,speed:560,message:"You rock!",points:10,keys:3},{score:300,speed:510,message:"Don't stop!",points:12,keys:4},{score:500,speed:490,message:"Tricky!",points:15,keys:4},{score:760,speed:465,message:"Great!",points:17,keys:4},{score:1100,speed:440,message:"I like your style!",points:20,keys:4},{score:1500,speed:390,message:"Awesome!",points:22,keys:4},{score:2e3,speed:360,message:"Yeah!!",points:25,keys:4},{score:2700,speed:330,message:"How do you do that?",points:27,keys:4},{score:3500,speed:310,message:"...how?",points:30,keys:4},{score:4300,speed:290,message:"Don't ever stop!!",points:32,keys:4},{score:5500,speed:280,message:"I'm really impressed.",points:35,keys:4},{score:7e3,speed:270,message:"Hangul hero!",points:40,keys:4},{score:1e4,speed:260,message:"You're really still here?",points:40,keys:4},{score:10500,speed:250,message:"That's incredible!",points:40,keys:4}],f=k[0],w=1,b=!1,A=5e3,E=A,T=[],I=localStorage.getItem("bestScore"),S=$(".mobile-controls"),D=sessionStorage.getItem("bestScore");D&&(localStorage.setItem("bestScore",D),I=D),$(document).keyup(function(e){if(32===e.keyCode&&(e.preventDefault(),"running"===b||"paused"===b?(b="running"===b?"paused":"running",$(".key").toggleClass("paused","paused"===b),$(".pause").toggleClass("show","paused"===b),"paused"===b?o():"running"===b&&i()):"end"===b&&r()),e.keyCode>=60&&e.keyCode<=90&&"paused"!==b&&"restart"!==b){if(e.preventDefault(),b===!1)return l(),!1;""!==y&&h.removeClass("s-"+y),y=u[e.keyCode],console.log(y),h.addClass("s-"+y)}}),I&&($(".best-points .value").text(I),$(".best").fadeIn()),S.find(p).on("touchstart",function(){var e=$(this).attr("class"),s=jQuery.Event("keyup");s.keyCode=c(e),$(document).trigger(s)}),S.find(".pause-btn").on("touchstart",function(){var e=jQuery.Event("keyup");e.keyCode=32,$(document).trigger(e)})});