"use strict";$(function(){function e(e){1>e&&(e=1),e=Math.floor(e),m+=e,k.addClass("bump"),c.html(m).addClass("bump").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){c.removeClass("bump"),k.removeClass("bump")});var s=$('<div class="ding">+'+e+"</div>");s.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).remove()}),k.append(s)}function s(){var e=v;for(var s in y){var n=y[s];if(m>=n.score)v=n;else if(m<n.score)break}v.speed!==e.speed&&$(".level-message").text(v.message).addClass("show").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("show")})}function n(n){if("paused"!==h&&a(n),"end"!==h&&"paused"!==h&&"restart"!==h){var o=["key-right","key-left","key-down","key-up"],i=o[Math.floor(Math.random()*v.keys)],r=u.find(".idle").first();r.length<=0?(r=$('<div class="key '+i+'"></div>'),r.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){if("end"!==h&&"restart"!==h&&!$(this).hasClass("idle")){$(this).hasClass(p)?(f+=200,f>C&&(f=C),e(v.points)):(f-=1e3,k.addClass("bad").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){k.removeClass("bad")})),s();var n=100*f/C,t=$(".percent");t.css("width",n+"%"),20>n?t.addClass("low"):60>n?t.addClass("medium").removeClass("low"):t.removeClass("low medium"),0>=f&&"running"===h&&d(),$(this).removeClass("key-up key-down key-left key-right").addClass("idle")}}),u.append(r)):r.removeClass("idle").addClass(i),t(v.speed)}}function t(e){var s=new Date,t={delay:e,started:s.getTime()};t.interval=setTimeout(n,e,t),w.push(t)}function a(e){var s=w.indexOf(e);s>-1&&w.splice(s,1)}function o(){var e=new Date;for(var s in w){var n=w[s];n.delay-=e.getTime()-n.started,n.started=null,clearInterval(n.interval)}}function i(){var e=new Date;for(var s in w){var t=w[s];t.started=e.getTime(),t.interval=setTimeout(n,t.delay,t)}}function d(){h="end",$(".key").addClass("hide"),$(".key-selector-container").addClass("hide").removeClass("show"),$(".results").addClass("show").removeClass("hide"),$(".points-container").addClass("hide").removeClass("show"),$(".pause-btn").text("Restart"),m>b&&(b=m,sessionStorage.setItem("bestScore",b),$(".best-points .value").text(b),$(".best").fadeIn()),ga("send",{hitType:"event",eventCategory:"game",eventAction:"score",eventValue:m})}function r(){h="restart",m=0,C=5e3,f=C,v=y[0],g=1,""!==p&&k.removeClass("s-"+p),p="",u.find(".key").removeClass("key-up key-down key-left key-right hide").addClass("idle"),$(".key-selector-container").addClass("show").removeClass("hide"),$(".results").addClass("hide").removeClass("show"),$(".points-container").addClass("show").removeClass("hide"),setTimeout(function(){for(var e in w){var s=w[e];clearInterval(s.interval)}w=[],c.html(m),$(".percent").css("width","100%").removeClass("low medium"),setTimeout(function(){h="running",$(".key").addClass("remove"),$(".pause-btn").text("Pause"),t(1)},950)},1e3)}function l(){h="running",$(".points-container").addClass("show"),$(".helper-container").addClass("hide"),setTimeout(function(){$(".key-selector").addClass("show fade").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("fade")})},500),t(1e3),$(".percent").css("width","100%")}var m=0,c=$(".points"),p="key-",u=$(".keys-container"),k=$(".key-selector"),y=[{score:0,speed:800,message:"",points:1,keys:1},{score:3,speed:750,message:"You've got it!",points:2,keys:2},{score:20,speed:670,message:"Keep going!",points:5,keys:3},{score:70,speed:620,message:"You're doing great!",points:7,keys:3},{score:150,speed:560,message:"You rock!",points:10,keys:3},{score:300,speed:510,message:"Don't stop!",points:12,keys:4},{score:500,speed:490,message:"Tricky!",points:15,keys:4},{score:760,speed:465,message:"Great!",points:17,keys:4},{score:1100,speed:440,message:"I like your style!",points:20,keys:4},{score:1500,speed:390,message:"Awesome!",points:22,keys:4},{score:2e3,speed:360,message:"Yeah!!",points:25,keys:4},{score:2700,speed:330,message:"How do you do that?",points:27,keys:4},{score:3500,speed:310,message:"...how?",points:30,keys:4},{score:4300,speed:290,message:"Don't ever stop!!",points:32,keys:4},{score:5500,speed:280,message:"I'm really impressed.",points:35,keys:4},{score:7e3,speed:270,message:"Arrow hero!",points:40,keys:4},{score:1e4,speed:260,message:"You're really still here?",points:40,keys:4},{score:10500,speed:250,message:"That's incredible!",points:40,keys:4}],v=y[0],g=1,h=!1,C=5e3,f=C,w=[],b=localStorage.getItem("bestScore"),A=$(".mobile-controls"),E=sessionStorage.getItem("bestScore");E&&(localStorage.setItem("bestScore",E),b=E),$(document).keydown(function(e){if(32===e.keyCode&&(e.preventDefault(),"running"===h||"paused"===h?(h="running"===h?"paused":"running",$(".key").toggleClass("paused","paused"===h),$(".pause").toggleClass("show","paused"===h),"paused"===h?o():"running"===h&&i()):"end"===h&&r()),e.keyCode>=37&&e.keyCode<=40&&"paused"!==h&&"restart"!==h){if(e.preventDefault(),h===!1)return l(),!1;switch(""!==p&&k.removeClass("s-"+p),e.keyCode){case 37:p="key-left";break;case 38:p="key-up";break;case 39:p="key-right";break;case 40:p="key-down"}k.addClass("s-"+p)}}),b&&($(".best-points .value").text(b),$(".best").fadeIn()),A.find(".key-up, .key-down, .key-left, .key-right").on("touchstart",function(){var e=$(this).attr("class"),s=jQuery.Event("keydown");switch(e){case"key-left":s.keyCode=37;break;case"key-up":s.keyCode=38;break;case"key-right":s.keyCode=39;break;case"key-down":s.keyCode=40}$(document).trigger(s)}),A.find(".pause-btn").on("touchstart",function(){var e=jQuery.Event("keydown");e.keyCode=32,$(document).trigger(e)})});